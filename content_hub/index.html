<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc; /* Light background */
            color: #334155; /* Darker text for contrast */
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); /* Subtle shadow */
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6; /* Primary blue for logo */
            cursor: pointer;
        }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
        }

        .stat-item {
            background: #f1f5f9; /* Light grey background for stats */
            padding: 8px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
            color: #475569;
        }

        /* Breadcrumbs */
        .breadcrumbs {
            background: #e2e8f0; /* Light grey for breadcrumbs */
            padding: 0.8rem 0;
            margin-bottom: 1.5rem;
            box-shadow: inset 0 -1px 0 rgba(0,0,0,0.05);
        }

        .breadcrumb-list {
            display: flex;
            list-style: none;
            gap: 8px;
            font-size: 0.9rem;
            color: #64748b;
            flex-wrap: wrap;
        }

        .breadcrumb-item a {
            color: #3b82f6;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .breadcrumb-item a:hover {
            color: #2563eb;
        }

        .breadcrumb-item.active {
            font-weight: 600;
            color: #1e293b;
        }

        /* Main Content Area */
        .main-content {
            padding-bottom: 3rem;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Grid Layout for Categories/Batches/Subjects */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .grid-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); /* Slightly more prominent shadow */
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px;
            text-align: center;
            min-height: 150px;
            border: 1px solid #e2e8f0;
        }

        .grid-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            border-color: #3b82f6;
        }

        .grid-card i {
            font-size: 3rem;
            color: #3b82f6; /* Primary blue for icons */
            margin-bottom: 15px;
        }

        .grid-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
        }

        .grid-card p {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 5px;
        }

        /* Content Cards (Videos/PDFs) */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .content-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #e2e8f0;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-color: #3b82f6;
        }

        .card-thumbnail {
            width: 100%;
            height: 180px;
            background: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .card-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-thumbnail .icon {
            font-size: 3rem;
            color: #64748b;
        }

        .card-type {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
        }

        .type-video {
            background: #ef4444; /* Red for video */
        }

        .type-pdf {
            background: #f59e0b; /* Orange for PDF */
        }

        .card-content {
            padding: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1e293b;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .card-source {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #64748b;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: #cbd5e1;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7); /* Darker overlay */
            z-index: 1000;
            padding: 20px;
            overflow-y: auto; /* Allow scrolling for modal content */
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            margin: 50px auto;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8fafc; /* Light header for modal */
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: #1e293b;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .video-container {
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden; /* Ensure video stays within bounds */
        }

        .video-container video {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .stats {
                flex-wrap: wrap;
                justify-content: center;
            }

            .grid-container, .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }

            .section-title {
                font-size: 1.5rem;
            }
        }

        /* Animation */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Fetch Lectures Button */
        .fetch-lectures-btn {
            display: block;
            width: fit-content;
            margin: 20px auto;
            padding: 12px 25px;
            background: #10b981; /* Green color */
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }

        .fetch-lectures-btn:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .fetch-lectures-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo" onclick="navigate('home')">
                    <i class="fas fa-folder"></i>
                    Content Hub
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <i class="fas fa-video" style="color: #ef4444;"></i>
                        <span id="totalVideoCount">0</span> Videos
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-file-pdf" style="color: #f59e0b;"></i>
                        <span id="totalPdfCount">0</span> PDFs
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock" style="color: #10b981;"></i>
                        <span id="lastUpdate">Never</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumbs -->
    <section class="breadcrumbs">
        <div class="container">
            <ul class="breadcrumb-list" id="breadcrumbs">
                <li class="breadcrumb-item"><a href="#" onclick="navigate('home')">Home</a></li>
            </ul>
        </div>
    </section>

    <!-- Main Content Area -->
    <main class="container main-content">
        <h2 class="section-title" id="currentViewTitle">Categories</h2>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Loading content...</p>
        </div>

        <!-- Dynamic Content Area (Categories/Batches/Subjects/Content) -->
        <div id="dynamicContentArea" class="grid-container">
            <!-- Content will be loaded here by JavaScript -->
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <i class="fas fa-box-open"></i>
            <h3>No Content Found</h3>
            <p>This section is empty. Please check back later or try a different path.</p>
        </div>
    </main>

    <!-- Video Modal -->
    <div class="modal" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Video Player</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="video-container" id="videoContainer">
                    <!-- Video will be loaded here -->
                </div>
                <div id="videoDetails">
                    <!-- Video details will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Global Data Store ---
        // This will store the initial batches structure (without lecture links)
        // and will be populated by the Python backend.
        let batchesStructure = {};
        // This will store the actual fetched lectures for a specific subject
        let fetchedLectures = { videos: [], pdfs: [] };

        // --- Navigation State ---
        let currentPath = []; // e.g., ['NEET', 'Kota NEET UG 2026 Master Pro 1', 'Physics']

        // --- DOM Elements ---
        const dynamicContentArea = document.getElementById('dynamicContentArea');
        const currentViewTitle = document.getElementById('currentViewTitle');
        const breadcrumbsList = document.getElementById('breadcrumbs');
        const loadingIndicator = document.getElementById('loading');
        const emptyState = document.getElementById('emptyState');
        const totalVideoCountSpan = document.getElementById('totalVideoCount');
        const totalPdfCountSpan = document.getElementById('totalPdfCount');
        const lastUpdateSpan = document.getElementById('lastUpdate');

        // --- Core Functions ---

        // Function to navigate through the content structure
        function navigate(level, name = null) {
            if (level === 'home') {
                currentPath = [];
            } else if (level === 'category') {
                currentPath = [name];
            } else if (level === 'batch') {
                currentPath = [currentPath[0], name];
            } else if (level === 'subject') {
                currentPath = [currentPath[0], currentPath[1], name];
            }
            renderCurrentView();
        }

        // Renders the content based on the currentPath
        async function renderCurrentView() {
            showLoading();
            dynamicContentArea.innerHTML = '';
            emptyState.style.display = 'none';

            updateBreadcrumbs();

            if (currentPath.length === 0) {
                // Home view: Show Categories
                currentViewTitle.textContent = 'Categories';
                renderCategories();
            } else if (currentPath.length === 1) {
                // Category view: Show Batches for selected category
                const categoryName = currentPath[0];
                currentViewTitle.textContent = `${categoryName} Batches`;
                renderBatches(categoryName);
            } else if (currentPath.length === 2) {
                // Batch view: Show Subjects for selected batch
                const batchName = currentPath[1];
                currentViewTitle.textContent = `${batchName} Subjects`;
                renderSubjects(batchName);
            } else if (currentPath.length === 3) {
                // Subject view: Show "Fetch Lectures" button and then content
                const batchName = currentPath[1];
                const subjectName = currentPath[2];
                currentViewTitle.textContent = `${subjectName} Content`;
                await renderSubjectContentPrompt(batchName, subjectName); // Await this
            }
            hideLoading();
        }

        // Renders the list of unique categories
        function renderCategories() {
            const categories = new Set();
            for (const batchKey in batchesStructure) {
                categories.add(batchesStructure[batchKey].category);
            }

            if (categories.size === 0) {
                emptyState.style.display = 'block';
                return;
            }

            dynamicContentArea.className = 'grid-container'; // Ensure correct grid for folders
            categories.forEach(category => {
                dynamicContentArea.innerHTML += `
                    <div class="grid-card fade-in" onclick="navigate('category', '${category}')">
                        <i class="fas fa-folder"></i>
                        <h3>${category}</h3>
                        <p>${getCategoryBatchCount(category)} Batches</p>
                    </div>
                `;
            });
        }

        // Renders the list of batches for a given category
        function renderBatches(categoryName) {
            const batches = [];
            for (const batchKey in batchesStructure) {
                if (batchesStructure[batchKey].category === categoryName) {
                    batches.push(batchKey);
                }
            }

            if (batches.length === 0) {
                emptyState.style.display = 'block';
                return;
            }

            dynamicContentArea.className = 'grid-container'; // Ensure correct grid for folders
            batches.forEach(batchName => {
                dynamicContentArea.innerHTML += `
                    <div class="grid-card fade-in" onclick="navigate('batch', '${batchName}')">
                        <i class="fas fa-folder-open"></i>
                        <h3>${batchName}</h3>
                        <p>${Object.keys(batchesStructure[batchName].subjects).length} Subjects</p>
                    </div>
                `;
            });
        }

        // Renders the list of subjects for a given batch
        function renderSubjects(batchName) {
            const batch = batchesStructure[batchName];
            if (!batch || Object.keys(batch.subjects).length === 0) {
                emptyState.style.display = 'block';
                return;
            }

            dynamicContentArea.className = 'grid-container'; // Ensure correct grid for folders
            for (const subjectName in batch.subjects) {
                const subject = batch.subjects[subjectName];
                // We don't know the content count yet, as it's fetched on demand
                dynamicContentArea.innerHTML += `
                    <div class="grid-card fade-in" onclick="navigate('subject', '${subjectName}')">
                        <i class="fas fa-book"></i>
                        <h3>${subjectName}</h3>
                        <p>Click to fetch lectures</p>
                    </div>
                `;
            }
        }

        // Renders a prompt to fetch lectures for a subject
        async function renderSubjectContentPrompt(batchName, subjectName) {
            const subject = batchesStructure[batchName]?.subjects[subjectName];
            if (!subject || !subject.uids || subject.uids.length === 0) {
                emptyState.style.display = 'block';
                emptyState.querySelector('h3').textContent = 'No UIDs found for this subject.';
                emptyState.querySelector('p').textContent = 'Cannot fetch lectures without UIDs.';
                return;
            }

            dynamicContentArea.className = 'grid-container'; // Keep grid for button
            dynamicContentArea.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 20px;">
                    <p style="font-size: 1.1rem; margin-bottom: 20px; color: #475569;">
                        Click the button below to fetch the latest video and PDF lectures for <b>${subjectName}</b>.
                    </p>
                    <button class="fetch-lectures-btn" id="fetchLecturesBtn">
                        <i class="fas fa-download"></i> Fetch Lectures
                    </button>
                </div>
            `;

            document.getElementById('fetchLecturesBtn').onclick = async () => {
                await fetchLecturesForSubject(batchName, subjectName);
            };
        }

        // Fetches and renders the actual video and PDF content for a given subject
        async function fetchLecturesForSubject(batchName, subjectName) {
            const subject = batchesStructure[batchName]?.subjects[subjectName];
            if (!subject || !subject.uids || subject.uids.length === 0) {
                alert("Error: No UIDs found for this subject.");
                return;
            }

            const fetchBtn = document.getElementById('fetchLecturesBtn');
            if (fetchBtn) {
                fetchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Fetching...';
                fetchBtn.disabled = true;
            }
            showLoading(); // Show global loading indicator

            try {
                // Make an API call to your Python backend
                // Your Python backend should take UIDs and return processed video/PDF links
                const response = await fetch('/api/fetch_lectures', { // Replace with your actual backend endpoint
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ uids: subject.uids })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                fetchedLectures = await response.json(); // Store the fetched data
                
                // Now render the actual content
                renderFetchedContent();

            } catch (error) {
                console.error("Error fetching lectures:", error);
                alert("Failed to fetch lectures. Please ensure your Python backend is running and accessible.");
                emptyState.style.display = 'block';
                emptyState.querySelector('h3').textContent = 'Failed to load lectures.';
                emptyState.querySelector('p').textContent = 'Check console for details or try again.';
            } finally {
                if (fetchBtn) {
                    fetchBtn.innerHTML = '<i class="fas fa-download"></i> Fetch Lectures';
                    fetchBtn.disabled = false;
                }
                hideLoading(); // Hide global loading indicator
            }
        }

        // Renders the content that was just fetched
        function renderFetchedContent() {
            dynamicContentArea.innerHTML = ''; // Clear previous content
            emptyState.style.display = 'none';

            const videos = fetchedLectures.videos || [];
            const pdfs = fetchedLectures.pdfs || [];

            if (videos.length === 0 && pdfs.length === 0) {
                emptyState.style.display = 'block';
                emptyState.querySelector('h3').textContent = 'No Lectures Found!';
                emptyState.querySelector('p').textContent = 'The scraping process returned no videos or PDFs for this subject.';
                return;
            }

            dynamicContentArea.className = 'content-grid'; // Switch to content grid layout
            let contentHtml = '';

            // Render Videos
            videos.forEach(video => {
                contentHtml += `
                    <div class="content-card fade-in" onclick="openVideoModal('${video.url}', '${video.title}', '${video.duration || 'N/A'}', '${video.source || 'Unknown'}')">
                        <div class="card-thumbnail">
                            <img src="${video.thumbnail || 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/c3334260-406f-4417-a4bb-d1ef5b2be253.png'}" alt="Video Thumbnail" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="icon" style="display: none;"><i class="fas fa-video"></i></div>
                            <span class="card-type type-video">VIDEO</span>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${video.title}</h3>
                            <div class="card-meta">
                                <span><i class="fas fa-clock"></i> ${video.duration || 'N/A'}</span>
                                <span><i class="fas fa-globe"></i> ${video.source || 'Unknown'}</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Render PDFs
            pdfs.forEach(pdf => {
                contentHtml += `
                    <div class="content-card fade-in" onclick="window.open('${pdf.url}', '_blank')">
                        <div class="card-thumbnail">
                            <img src="${pdf.thumbnail || 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/a2e1f806-37f3-42fa-bb6f-c293e7043550.png'}" alt="PDF Thumbnail" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="icon" style="display: none;"><i class="fas fa-file-pdf"></i></div>
                            <span class="card-type type-pdf">PDF</span>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${pdf.title}</h3>
                            <div class="card-meta">
                                <span><i class="fas fa-file-alt"></i> ${pdf.pages || 'N/A'} pages</span>
                                <span><i class="fas fa-database"></i> ${pdf.size || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            dynamicContentArea.innerHTML = contentHtml;
        }


        // Updates the breadcrumbs navigation
        function updateBreadcrumbs() {
            breadcrumbsList.innerHTML = '<li class="breadcrumb-item"><a href="#" onclick="navigate(\'home\')">Home</a></li>';
            let path = '';
            currentPath.forEach((segment, index) => {
                path += (index === 0 ? '' : '/') + segment;
                const isLast = index === currentPath.length - 1;
                let onclick = '';
                if (!isLast) {
                    if (index === 0) onclick = `navigate('category', '${segment}')`;
                    if (index === 1) onclick = `navigate('batch', '${segment}')`;
                }
                breadcrumbsList.innerHTML += `
                    <li class="breadcrumb-item ${isLast ? 'active' : ''}">
                        ${isLast ? segment : `<a href="#" onclick="${onclick}">${segment}</a>`}
                    </li>
                `;
            });
        }

        // Updates the total video and PDF counts in the header
        function updateGlobalStats() {
            let totalVideos = 0;
            let totalPdfs = 0;

            for (const batchKey in batchesStructure) {
                const batch = batchesStructure[batchKey];
                for (const subjectName in batch.subjects) {
                    const subject = batch.subjects[subjectName];
                    // Note: We can only count UIDs here, not actual fetched content
                    // as content is fetched on demand.
                    // If you want total counts of ALL scraped content, your Python backend
                    // would need to pre-process and provide these numbers.
                    if (subject.uids) {
                        // For now, we'll just count the number of subjects with UIDs
                        // as a proxy for "potential" content.
                        // A more accurate count would require fetching all content, which is slow.
                    }
                }
            }
            // These stats will now reflect the number of UIDs, not actual videos/pdfs
            // unless your Python backend pre-calculates and sends them.
            totalVideoCountSpan.textContent = 'N/A'; // Or pre-calculated from backend
            totalPdfCountSpan.textContent = 'N/A';   // Or pre-calculated from backend
            lastUpdateSpan.textContent = new Date().toLocaleString();
        }

        // Helper to get batch count for a category
        function getCategoryBatchCount(categoryName) {
            let count = 0;
            for (const batchKey in batchesStructure) {
                if (batchesStructure[batchKey].category === categoryName) {
                    count++;
                }
            }
            return count;
        }

        // --- Loading and Empty State Management ---
        function showLoading() {
            loadingIndicator.style.display = 'block';
            dynamicContentArea.style.display = 'none';
            emptyState.style.display = 'none';
        }

        function hideLoading() {
            loadingIndicator.style.display = 'none';
            dynamicContentArea.style.display = 'grid'; // Always show grid when content is ready
        }

        // --- Modal Functions ---
        function openVideoModal(videoUrl, title, duration, source) {
            const modal = document.getElementById('videoModal');
            const videoContainer = document.getElementById('videoContainer');
            const videoDetails = document.getElementById('videoDetails');
            const modalTitle = document.getElementById('modalTitle');

            modalTitle.textContent = title;
            videoContainer.innerHTML = `<video controls autoplay src="${videoUrl}"></video>`;
            videoDetails.innerHTML = `
                <h4 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;">${title}</h4>
                <p style="color: #64748b; font-size: 0.9rem;">
                    <i class="fas fa-clock"></i> Duration: ${duration || 'N/A'} |
                    <i class="fas fa-globe"></i> Source: ${source || 'Unknown'}
                </p>
                <a href="${videoUrl}" target="_blank" style="display: inline-block; margin-top: 1rem; padding: 8px 15px; background: #3b82f6; color: white; border-radius: 5px; text-decoration: none;">
                    <i class="fas fa-external-link-alt"></i> Open in New Tab
                </a>
            `;
            modal.style.display = 'block';
        }

        function closeModal() {
            const modal = document.getElementById('videoModal');
            const videoContainer = document.getElementById('videoContainer');
            videoContainer.innerHTML = ''; // Stop video playback
            modal.style.display = 'none';
        }

        // --- Data Refresh Function (for Python integration) ---
        // This function will be called by your Python script
        // when it has new data from batches.json
        async function loadBatchesStructure() {
            showLoading();
            try {
                // Fetch the batches.json structure from your Python backend
                // Your Python backend should serve this file or its content
                const response = await fetch('/api/batches_structure'); // Replace with your actual backend endpoint
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                batchesStructure = await response.json();
                updateGlobalStats(); // Update stats based on the loaded structure
                renderCurrentView(); // Render the initial view (categories)
            } catch (error) {
                console.error("Error fetching batches structure:", error);
                alert("Failed to load batch structure. Please ensure your Python backend is running and accessible.");
                batchesStructure = {}; // Clear data on error
                emptyState.style.display = 'block';
                emptyState.querySelector('h3').textContent = 'Could not load batches.';
                emptyState.querySelector('p').textContent = 'Please check your backend server.';
            } finally {
                hideLoading();
            }
        }

        function refreshData() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
            refreshBtn.disabled = true;
            
            // Reload the entire batches structure
            loadBatchesStructure().then(() => {
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                refreshBtn.disabled = false;
            });
        }

        // Initial load of the batches structure when the page loads
        loadBatchesStructure();

    </script>
</body>
</html>
