<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Achiever Batch Video Player</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    /* CSS Variables for theming */
    :root {
      --bg-color: linear-gradient(135deg, #f0f2f5, #e0e5ec);
      --header-bg: #ffffff;
      --text-color: #333;
      --heading-color: #2c3e50;
      --subheading-color: #7f8c8d;
      --search-bg: #fdfdfd;
      --search-border: #dcdcdc;
      --search-focus-border: #3498db;
      --subject-section-bg: #ffffff;
      --subject-header-color: #3498db;
      --subject-header-border: #ecf0f1;
      --lecture-card-bg: #fdfdfd;
      --lecture-card-border: #f0f0f0;
      --lecture-title-color: #34495e;
      --lecture-date-color: #95a5a6;
      --play-btn-bg: #2ecc71;
      --play-btn-hover-bg: #27ae60;
      --pdf-btn-bg: #e74c3c;
      --pdf-btn-hover-bg: #c0392b;
      --footer-color: #7f8c8d;
      --popup-bg: #000;
      --popup-overlay-bg: rgba(0,0,0,0.75);
      --close-btn-bg: #ff6b6b;
      --close-btn-hover-bg: #ee5253;
      --controls-bg: rgba(0, 0, 0, 0.7);
      --controls-text: #fff;
      --view-pdf-btn-bg: #3498db; /* New: View PDF button color */
      --view-pdf-btn-hover-bg: #2980b9; /* New: View PDF button hover color */
    }

    /* Dark Mode Variables */
    body.dark-mode {
      --bg-color: linear-gradient(135deg, #2c3e50, #1a252f);
      --header-bg: #34495e;
      --text-color: #ecf0f1;
      --heading-color: #ecf0f1;
      --subheading-color: #bdc3c7;
      --search-bg: #4a627a;
      --search-border: #5a728a;
      --search-focus-border: #3498db;
      --subject-section-bg: #34495e;
      --subject-header-color: #85c1e9;
      --subject-header-border: #4a627a;
      --lecture-card-bg: #4a627a;
      --lecture-card-border: #5a728a;
      --lecture-title-color: #ecf0f1;
      --lecture-date-color: #bdc3c7;
      --play-btn-bg: #27ae60;
      --play-btn-hover-bg: #219d55;
      --pdf-btn-bg: #c0392b;
      --pdf-btn-hover-bg: #a93226;
      --footer-color: #bdc3c7;
      --popup-bg: #1a1a1a;
      --popup-overlay-bg: rgba(0,0,0,0.85);
      --close-btn-bg: #e74c3c;
      --close-btn-hover-bg: #c0392b;
      --controls-bg: rgba(0, 0, 0, 0.8);
      --controls-text: #fff;
      --view-pdf-btn-bg: #2980b9; /* New: View PDF button color for dark mode */
      --view-pdf-btn-hover-bg: #2471a3; /* New: View PDF button hover color for dark mode */
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      text-align: center;
      padding: 20px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Password Screen Styles */
    #passwordScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .password-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      text-align: center;
      min-width: 300px;
      max-width: 400px;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .password-container h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.8em;
      font-weight: 600;
    }

    .password-container p {
      color: #666;
      margin-bottom: 25px;
      font-size: 1em;
      line-height: 1.5;
    }

    #passwordInput {
      width: 80%;
      padding: 15px 20px;
      border: 2px solid #ddd;
      border-radius: 30px;
      font-size: 1.1em;
      text-align: center;
      margin-bottom: 20px;
      outline: none;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    #passwordInput:focus {
      border-color: #667eea;
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
    }

    #submitPassword {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 30px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      min-width: 120px;
    }

    #submitPassword:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    #submitPassword:active {
      transform: translateY(0);
    }

    .error-message {
      color: #e74c3c;
      margin-top: 15px;
      font-size: 0.95em;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .error-message.show {
      opacity: 1;
    }

    .password-hint {
      color: #888;
      font-size: 0.85em;
      margin-top: 20px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 10px;
    }

    header {
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      padding: 15px 25px;
      background: var(--header-bg);
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    header .header-left {
      text-align: center;
      flex-grow: 1;
      margin-right: 20px;
    }
    header h1 {
      margin: 0;
      font-size: 2.5em;
      color: var(--heading-color);
      font-weight: 700;
      transition: color 0.3s ease;
    }
    header h2 {
      margin: 5px 0 0;
      font-size: 1.4em;
      color: var(--subheading-color);
      font-weight: 400;
      transition: color 0.3s ease;
    }

    /* New: Header Right for global elements */
    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .search-container {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .search-container input {
      padding: 12px 20px;
      border: 1px solid var(--search-border);
      border-radius: 30px;
      font-size: 1.05em;
      width: 280px;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      background-color: var(--search-bg);
      color: var(--text-color);
    }
    .search-container input:focus {
      border-color: var(--search-focus-border);
      box-shadow: 0 0 10px rgba(52,152,219,0.3);
      outline: none;
      background-color: var(--header-bg);
    }

    .dark-mode-toggle {
      background: var(--subject-header-color);
      color: white;
      border: none;
      border-radius: 30px;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
      transition: background 0.3s ease, transform 0.2s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .dark-mode-toggle:hover {
      background: var(--subject-header-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .lectures-container {
      max-width: 960px;
      margin: auto;
      text-align: left;
    }

    /* New: Subject Folder Card Styles */
    .subject-folder-card {
      background: var(--subject-section-bg);
      border-radius: 15px;
      margin-bottom: 15px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      border: 1px solid var(--lecture-card-border);
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.3s ease;
      cursor: pointer;
      text-align: center;
    }

    .subject-folder-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    }

    .subject-folder-card h3 {
      font-size: 1.8em;
      color: var(--subject-header-color);
      margin: 0;
      font-weight: 600;
    }

    /* New: Back Button */
    .back-btn {
      background: var(--pdf-btn-bg); /* Reusing PDF button style for consistency */
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      margin-bottom: 20px;
      transition: background 0.3s ease, transform 0.2s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .back-btn:hover {
      background: var(--pdf-btn-hover-bg);
      transform: translateY(-2px);
    }

    /* New: Folder Specific Search */
    .folder-search {
      margin-bottom: 20px;
      display: flex; /* Use flex to center input */
      justify-content: center;
    }

    .folder-search input {
      padding: 12px 20px;
      border: 1px solid var(--search-border);
      border-radius: 30px;
      font-size: 1.05em;
      width: 280px; /* Default width */
      max-width: 500px; /* Limit max width */
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      background-color: var(--search-bg);
      color: var(--text-color);
    }
    .folder-search input:focus {
      border-color: var(--search-focus-border);
      box-shadow: 0 0 10px rgba(52,152,219,0.3);
      outline: none;
      background-color: var(--header-bg);
    }


    /* New: Folder Title */
    .folder-title {
      font-size: 2em;
      color: var(--heading-color);
      margin-bottom: 25px;
      text-align: center;
    }

    /* Existing lecture card styles (no change needed here) */
    .lecture-card {
      background: var(--lecture-card-bg);
      margin: 10px 0;
      padding: 18px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.07);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.3s ease, border-color 0.3s ease;
      border: 1px solid var(--lecture-card-border);
    }
    .lecture-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    .lecture-info {
      max-width: 68%;
    }
    .lecture-info h3 {
      margin: 0 0 6px;
      font-size: 1.15em;
      color: var(--lecture-title-color);
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .lecture-info span {
      font-size: 0.9em;
      color: var(--lecture-date-color);
      transition: color 0.3s ease;
    }
    .btn-group {
      display: flex;
      gap: 12px;
      flex-shrink: 0;
    }
    .play-btn, .pdf-btn, .view-pdf-btn { /* Added .view-pdf-btn */
      padding: 11px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.25s ease, transform 0.15s ease, box-shadow 0.25s ease;
      font-size: 0.95em;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .play-btn {
      background: var(--play-btn-bg);
      color: white;
    }
    .play-btn:hover {
      background: var(--play-btn-hover-bg);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(46,204,113,0.3);
    }
    .pdf-btn {
      background: var(--pdf-btn-bg);
      color: white;
      text-decoration: none;
    }
    .pdf-btn:hover {
      background: var(--pdf-btn-hover-bg);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(231,76,60,0.3);
    }
    /* New: View PDF button style */
    .view-pdf-btn {
      background: var(--view-pdf-btn-bg);
      color: white;
    }
    .view-pdf-btn:hover {
      background: var(--view-pdf-btn-hover-bg);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(52,152,219,0.3);
    }


    /* Popup Styles */
    #popupOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--popup-overlay-bg);
      z-index: 999;
      backdrop-filter: blur(5px);
      transition: background 0.3s ease;
    }
    #popupPlayer {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 1000px;
      /* aspect-ratio will be set dynamically by JS */
      background: var(--popup-bg);
      z-index: 1000;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 15px 40px rgba(0,0,0,0.5);
      animation: fadeIn 0.3s ease;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      box-sizing: border-box;
    }
    #popupPlayer video,
    #popupPlayer iframe,
    #popupPlayer #pdfViewer { /* Added #pdfViewer */
      width: 100%;
      height: 100%;
      border: none;
      display: block;
      /* object-fit: contain; for video, object-fit: fill; for PDF */
    }
    #popupPlayer #pdfViewer {
        object-fit: fill; /* For PDF to fill the space */
    }


    .player-controls {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--controls-bg);
      padding: 10px 20px;
      box-sizing: border-box;
      display: flex; /* Default display */
      justify-content: flex-end;
      align-items: center;
      gap: 15px;
      color: var(--controls-text);
      font-size: 0.9em;
    }
    .player-controls label {
      margin-right: 5px;
    }
    .player-controls select {
      background: rgba(255,255,255,0.2);
      color: var(--controls-text);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 5px;
      padding: 5px 8px;
      font-size: 0.9em;
      cursor: pointer;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ffffff%22%20d%3D%22M287%2C197.9L159.3%2C69.2c-3.7-3.7-9.7-3.7-13.4%2C0L5.4%2C197.9c-3.7%2C3.7-3.7%2C9.7%2C0%2C13.4l22.7%2C22.7c3.7%2C3.7%2C9.7%2C3.7%2C13.4%2C0l100.4-100.4l100.4%2C100.4c3.7%2C3.7%2C9.7%2C3.7%2C13.4%2C0l22.7-22.7C290.7%2C207.6%2C290.7%2C201.6%2C287%2C197.9z%22%2F%3E%3C%2Fsvg%3E');
      background-repeat: no-repeat;
      background-position: right 8px top 50%;
      background-size: 12px auto;
    }
    .player-controls select option {
      background: var(--controls-bg);
      color: var(--controls-text);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -48%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    #closeBtn {
      position: absolute;
      top: 15px;
      right: 20px;
      background: var(--close-btn-bg);
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 7px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s, box-shadow 0.2s;
      z-index: 1001;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #closeBtn:hover {
      background: var(--close-btn-hover-bg);
    }
    footer {
      margin-top: 50px;
      font-size: 0.95em;
      color: var(--footer-color);
      transition: color 0.3s ease;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .password-container {
        padding: 30px 20px;
        margin: 20px;
        min-width: auto;
      }

      #passwordInput {
        width: 90%;
      }

      header {
        flex-direction: column;
        align-items: center;
        padding: 15px;
      }
      header .header-left {
        margin-right: 0;
        margin-bottom: 15px;
      }
      header h1 {
        font-size: 2em;
      }
      header h2 {
        font-size: 1.1em;
      }

      /* New: Responsive for header-right */
      .header-right {
        width: 100%;
        justify-content: center;
        margin-top: 15px;
      }
      .dark-mode-toggle {
        width: auto; /* Let it size naturally */
      }

      /* New: Responsive for folder cards */
      .subject-folder-card {
        padding: 20px;
      }
      .subject-folder-card h3 {
        font-size: 1.5em;
      }

      /* New: Responsive for back button */
      .back-btn {
        width: 100%;
        text-align: center;
      }

      /* New: Responsive for folder search */
      .folder-search input {
        width: calc(100% - 30px); /* Adjust for smaller screens */
      }
      .folder-title {
        font-size: 1.6em;
      }

      .lecture-card {
        flex-direction: column;
        align-items: flex-start;
        padding: 15px;
      }
      .lecture-info {
        max-width: 100%;
        margin-bottom: 10px;
      }
      .lecture-info h3 {
        font-size: 1em;
      }
      .btn-group {
        width: 100%;
        justify-content: space-around;
        gap: 8px;
      }
      .play-btn, .pdf-btn, .view-pdf-btn { /* Added .view-pdf-btn */
        flex-grow: 1;
        text-align: center;
        padding: 10px 15px;
        font-size: 0.85em;
      }
      #popupPlayer {
        width: 95%;
      }
      #popupPlayer video,
      #popupPlayer iframe,
      #popupPlayer #pdfViewer { /* Added #pdfViewer */
        height: 100%;
      }
      .player-controls {
        padding: 8px 15px;
        gap: 10px;
      }
      .player-controls select {
        font-size: 0.8em;
        padding: 4px 6px;
      }
    }
  </style>
</head>
<body>

  <!-- Password Screen -->
  <div id="passwordScreen">
    <div class="password-container">
      <h2>Access Required</h2>
      <p>Please enter the password to access Achiever Online Dropper Batch lectures</p>
      <input type="password" id="passwordInput" placeholder="Enter password" maxlength="50">
      <br>
      <button id="submitPassword">Enter</button>
      <div id="errorMessage" class="error-message">Incorrect password. Please try again.</div>
      <div class="password-hint">
        Hint: Related to a popular electric-type Pokemon
      </div>
    </div>
  </div>

  <!-- Main Content (Hidden Initially) -->
  <div id="mainContent" style="display: none;">
    <header>
      <div class="header-left">
        <div style="font-size: 0.9em; color: var(--lecture-date-color); margin-bottom: 5px; transition: color 0.3s ease;">Made With Love by PIKACHU</div>
        <h1>Achiever Online Dropper Batch</h1>
      </div>
      <div class="header-right">
        <button id="darkModeToggle" class="dark-mode-toggle">Toggle Dark Mode</button>
      </div>
    </header>

    <div class="lectures-container">
      <!-- Container for Subject Folders -->
      <div id="subjectListContainer"></div>

      <!-- Container for Lectures within a Folder -->
      <div id="folderContentContainer" style="display: none;">
        <button id="backToSubjectsBtn" class="back-btn">‚Üê Back to Subjects</button>
        <div class="search-container folder-search">
          <input type="text" id="folderSearchInput" placeholder="Search lectures in this folder...">
        </div>
        <h2 id="currentSubjectTitle" class="folder-title"></h2>
        <div id="currentSubjectLectures"></div>
      </div>
    </div>

    <footer>
      &copy; 2025 PIKACHU Player
    </footer>

    <!-- Popup Overlay and Player -->
    <div id="popupOverlay"></div>
    <div id="popupPlayer">
      <button id="closeBtn">X</button>
      <video id="videoPlayer" controls playsinline></video>
      <iframe id="ytPlayer" style="display:none;" allowfullscreen></iframe>
      <iframe id="pdfViewer" style="display:none;" allowfullscreen></iframe> <!-- New: PDF Viewer iframe -->
      <div class="player-controls"> <!-- This div will be shown/hidden -->
        <label for="playbackSpeed">Speed:</label>
        <select id="playbackSpeed">
          <option value="0.5">0.5x</option>
          <option value="0.75">0.75x</option>
          <option value="1" selected>Normal</option>
          <option value="1.25">1.25x</option>
          <option value="1.5">1.5x</option>
          <option value="1.75">1.75x</option>
          <option value="2">2x</option>
        </select>
      </div>
    </div>
  </div>

  <script>
    // Password functionality
    const correctPassword = "PIKACHU";
    const passwordScreen = document.getElementById("passwordScreen");
    const mainContent = document.getElementById("mainContent");
    const passwordInput = document.getElementById("passwordInput");
    const submitButton = document.getElementById("submitPassword");
    const errorMessage = document.getElementById("errorMessage");

    function checkPassword() {
      const enteredPassword = passwordInput.value.trim();

      if (enteredPassword === correctPassword) {
        passwordScreen.style.display = "none";
        mainContent.style.display = "block";
        // Load lectures after successful password entry
        loadAndRenderLectures();
      } else {
        errorMessage.classList.add("show");
        passwordInput.value = "";
        passwordInput.style.borderColor = "#e74c3c";

        setTimeout(() => {
          errorMessage.classList.remove("show");
          passwordInput.style.borderColor = "#ddd";
        }, 3000);
      }
    }

    submitButton.addEventListener("click", checkPassword);
    passwordInput.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        checkPassword();
      }
    });

    // Main application variables
    let lecturesData = [];
    const subjectListContainer = document.getElementById("subjectListContainer");
    const folderContentContainer = document.getElementById("folderContentContainer");
    const backToSubjectsBtn = document.getElementById("backToSubjectsBtn");
    const folderSearchInput = document.getElementById("folderSearchInput");
    const currentSubjectTitle = document.getElementById("currentSubjectTitle");
    const currentSubjectLectures = document.getElementById("currentSubjectLectures");

    const darkModeToggle = document.getElementById("darkModeToggle");
    const playbackSpeedSelect = document.getElementById("playbackSpeed");
    const videoPlayer = document.getElementById("videoPlayer");
    const ytPlayer = document.getElementById("ytPlayer");
    const pdfViewer = document.getElementById("pdfViewer"); // New: Get PDF viewer iframe
    const popupPlayer = document.getElementById("popupPlayer"); // Get the popup container
    const playerControls = document.querySelector(".player-controls"); // Get the controls div

    let currentSubjectLecturesData = []; // To hold lectures of the currently viewed folder

    // Function to get the subject name from the lecture title - UPDATED WITH MORE ROBUST CHECKING
    function getSubjectName(title) {
      // Convert title to lowercase for case-insensitive comparison
      const titleLower = title.toLowerCase();
      
      // Check for Test entries first (more specific check)
      if (titleLower.startsWith("test")) return "Tests";
      
      // Check for Module entries (more specific check)
      if (titleLower.startsWith("module")) return "Modules";
      
      // Original subject checks
      if (title.startsWith("Physics (11th)")) return "Physics 11th";
      if (title.startsWith("Physics (12th)")) return "Physics 12th";
      if (title.startsWith("Organic Chemistry")) return "Organic Chemistry";
      if (title.startsWith("Inorganic Chemistry")) return "Inorganic Chemistry";
      if (title.startsWith("Zoology")) return "Zoology";
      if (title.startsWith("Botany")) return "Botany";
      
      // Fallback
      return "Other Lectures";
    }

    // Function to fetch and render lectures (initial load)
    async function loadAndRenderLectures() {
      try {
        const response = await fetch('lecture.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        lecturesData = await response.json();
        
        // Debug: Log each lecture's title and corresponding subject
        console.log("Debug: Lecture titles and their assigned subjects:");
        lecturesData.forEach(lec => {
          console.log(`"${lec.title}" -> "${getSubjectName(lec.title)}"`);
        });
        
        renderSubjectFolders(lecturesData); // Call new function to render folders
      } catch (error) {
        console.error("Could not load lectures:", error);
        subjectListContainer.innerHTML = '<p style="color: var(--pdf-btn-bg);">Failed to load lectures. Please check lecture.json.</p>';
      }
    }

    // New function: Render subject folders
    function renderSubjectFolders(allLectures) {
      subjectListContainer.innerHTML = '';
      folderContentContainer.style.display = 'none';
      subjectListContainer.style.display = 'block';

      const subjects = new Set();
      allLectures.forEach(lec => {
        subjects.add(getSubjectName(lec.title));
      });

      // Debug: Log all unique subjects found
      console.log("Debug: All unique subjects found:", Array.from(subjects));

      const sortedSubjects = Array.from(subjects).sort((a, b) => {
        // Define a custom order for subjects
        const order = ["Physics 11th", "Physics 12th", "Organic Chemistry", "Inorganic Chemistry", "Zoology", "Botany", "Tests", "Modules", "Other Lectures"];
        return order.indexOf(a) - order.indexOf(b);
      });

      sortedSubjects.forEach(subjectName => {
        const folderCard = document.createElement("div");
        folderCard.className = "subject-folder-card";
        folderCard.innerHTML = `<h3>${subjectName}</h3>`;
        folderCard.onclick = () => openSubjectFolder(subjectName);
        subjectListContainer.appendChild(folderCard);
      });
    }

    // New function: Open a specific subject folder
    function openSubjectFolder(subjectName) {
      subjectListContainer.style.display = 'none';
      folderContentContainer.style.display = 'block';
      currentSubjectTitle.textContent = subjectName;
      folderSearchInput.value = ''; // Clear search input when opening a new folder

      currentSubjectLecturesData = lecturesData.filter(lec => getSubjectName(lec.title) === subjectName);
      
      // Debug: Log lectures for this specific subject
      console.log(`Debug: Lectures for subject "${subjectName}":`, currentSubjectLecturesData.map(lec => lec.title));
      
      renderLecturesInFolder(currentSubjectLecturesData);
    }

    // New function: Render lectures within a specific folder
    function renderLecturesInFolder(lecturesToRender) {
      currentSubjectLectures.innerHTML = '';
      if (lecturesToRender.length === 0) {
        currentSubjectLectures.innerHTML = '<p style="text-align: center; color: var(--subheading-color);">No lectures found in this category.</p>';
        return;
      }

      lecturesToRender.forEach(lec => {
        const card = document.createElement("div");
        card.className = "lecture-card";

        const info = document.createElement("div");
        info.className = "lecture-info";
        info.innerHTML = `<h3>${lec.title}</h3><span>${lec.date}</span>`;

        const btnGroup = document.createElement("div");
        btnGroup.className = "btn-group";

        // Conditionally create Play button only if a URL exists
        if (lec.url && lec.url.trim() !== "") {
            const playBtn = document.createElement("button");
            playBtn.className = "play-btn";
            playBtn.textContent = "Play Online";
            playBtn.onclick = () => openPopup(lec.url);
            btnGroup.appendChild(playBtn);
        }

        if (lec.pdf) {
          // New: View PDF button
          const viewPdfBtn = document.createElement("button");
          viewPdfBtn.className = "view-pdf-btn";
          viewPdfBtn.textContent = "View PDF";
          viewPdfBtn.onclick = () => openPopup(lec.pdf); // Open PDF in popup
          btnGroup.appendChild(viewPdfBtn);

          // Existing: Download PDF button
          const pdfBtn = document.createElement("a");
          pdfBtn.className = "pdf-btn";
          pdfBtn.textContent = "Download PDF";
          pdfBtn.href = lec.pdf;
          pdfBtn.target = "_blank";
          btnGroup.appendChild(pdfBtn);
        }

        card.appendChild(info);
        card.appendChild(btnGroup);
        currentSubjectLectures.appendChild(card);
      });
    }

    // Event listener for "Back to Subjects" button
    backToSubjectsBtn.addEventListener('click', () => {
      renderSubjectFolders(lecturesData); // Go back to the main subject list
    });

    // Search functionality for lectures within a folder
    folderSearchInput.addEventListener("input", (e) => {
      const searchTerm = e.target.value.toLowerCase();
      const filteredLectures = currentSubjectLecturesData.filter(lec =>
        lec.title.toLowerCase().includes(searchTerm)
      );
      renderLecturesInFolder(filteredLectures);
    });

    const popup = document.getElementById("popupPlayer");
    const overlay = document.getElementById("popupOverlay");
    const closeBtn = document.getElementById("closeBtn");

    function openPopup(url) {
      overlay.style.display = 'block';
      popup.style.display = 'flex';
      playSource(url);
    }

    function closePopup() {
      popup.style.display = 'none';
      overlay.style.display = 'none';
      
      // Reset video player
      videoPlayer.pause();
      videoPlayer.removeAttribute('src');
      if (Hls.isSupported()) {
        if (videoPlayer._hls) {
          videoPlayer._hls.destroy();
          videoPlayer._hls = null;
        }
      }
      
      // Reset YouTube player
      ytPlayer.src = '';
      
      // Reset PDF viewer
      pdfViewer.src = ''; 
      
      playbackSpeedSelect.value = "1";
      
      // Reset popup styles
      popupPlayer.style.aspectRatio = '16 / 9'; // Reset aspect ratio for videos
      playerControls.style.display = 'flex'; // Show controls by default on close
    }

    closeBtn.onclick = closePopup;
    overlay.onclick = closePopup;

    function playSource(url) {
      // Hide all players initially
      videoPlayer.style.display = 'none';
      ytPlayer.style.display = 'none';
      pdfViewer.style.display = 'none'; 
      playerControls.style.display = 'none'; // Hide controls by default
      popupPlayer.style.aspectRatio = 'auto'; // Default to auto for flexibility

      // Clear sources
      videoPlayer.src = '';
      ytPlayer.src = '';
      pdfViewer.src = ''; 

      // Handle cases where there is no URL
      if (!url || url.trim() === "") {
        alert('No content available for this item.');
        closePopup();
        return;
      }

      if (url.includes('youtube.com/embed/') || url.includes('youtu.be/')) {
        ytPlayer.style.display = 'block';
        popupPlayer.style.aspectRatio = '16 / 9'; // Set aspect ratio for YouTube
        let embedUrl = url;
        if (url.includes('youtu.be/')) {
            const videoId = url.split('youtu.be/')[1].split('?')[0];
            embedUrl = `https://www.youtube.com/embed/${videoId}`;
        } else if (url.includes('watch?v=')) {
            const videoId = url.split('watch?v=')[1].split('&')[0];
            embedUrl = `https://www.youtube.com/embed/${videoId}`;
        }
        ytPlayer.src = `${embedUrl}?autoplay=1&controls=1&modestbranding=1&rel=0`;
      } else if (url.endsWith('.m3u8')) {
        videoPlayer.style.display = 'block';
        popupPlayer.style.aspectRatio = '16 / 9'; // Set aspect ratio for HLS video
        playerControls.style.display = 'flex'; // Show controls for HLS video

        if (Hls.isSupported()) {
          if (videoPlayer._hls) {
            videoPlayer._hls.destroy();
          }
          const hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(videoPlayer);
          videoPlayer._hls = hls;
        } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
          videoPlayer.src = url;
        } else {
          alert('HLS is not supported in this browser.');
        }
      } else if (url.toLowerCase().endsWith('.pdf')) { 
        pdfViewer.style.display = 'block';
        popupPlayer.style.aspectRatio = 'auto'; // Allow PDF to fill available space
        // For direct PDF viewing, append #toolbar=0&navpanes=0 to hide some UI elements
        // Note: Browser support for these parameters varies.
        pdfViewer.src = `${url}#toolbar=0&navpanes=0`; 
      } else if (url.endsWith('.mithu')) {
        alert('This video format (.mithu) is not directly playable in a web browser without a specific player or decryption. Please try a different video.');
      }
      else {
        alert('Unsupported file link: ' + url);
      }
    }

    // Playback Speed Control
    playbackSpeedSelect.addEventListener('change', (event) => {
      videoPlayer.playbackRate = parseFloat(event.target.value);
    });

    // Dark Mode Toggle
    darkModeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      if (document.body.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark');
      } else {
        localStorage.setItem('theme', 'light');
      }
    });

    // On page load
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
      }
      // Note: loadAndRenderLectures() is called only after successful password entry
    });
  </script>
</body>
</html>
